<!DOCTYPE html>

<html>
<head>
    <title>WebAssembly - Chemical Visualizer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: arial;
            overflow-x: hidden;
            overflow-y: hidden;
        }

        .emscripten {
            position: absolute;
            top: 0px;
            left: 0px;
            margin: 0px;
            padding: 0px;
            border: 0px;
            width: calc(100% - 200px);
            min-width: min(100%, 1000px);
            height: 100%;
            display: block;
        }

        .header {
            position: absolute;
            text-align: center;
            color: white;
            width: calc(100% - 200px);
            min-width: min(100%, 1000px);
            font-size: 2rem;
            padding: 16px;
            display: inline-block;
            pointer-events: none;
            bottom: 0px;
        }

        .throbber {
            position: absolute;
            top: 0px;
            left: 0px;
            margin: 0px;
            padding: 0px;
            border: 0px;
            width: 100%;
            height: 100%;

            background-color: rgb(31, 33, 51);
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="-20 -20 40 40"> <style> circle { animation: 4s a infinite linear, 3s o infinite linear; } @keyframes a {from{stroke-dasharray:100 0}50%25{stroke-dasharray:0 100}to{stroke-dasharray:100 0}} @keyframes o {from{stroke-dashoffset:75}to{stroke-dashoffset:375}} <%2Fstyle><circle r="8" stroke-width="2.4" fill="none" stroke="%23654EF0" /> </svg>');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: 50vmin;
            z-index: 3;
        }

        .ui {
            height: 100%; /* Full-height: remove this if you want "auto" height */
            width: 200px; /* Set the width of the sidebar */
            position: fixed; /* Fixed Sidebar (stay in place on scroll) */
            z-index: 1; /* Stay on top */
            top: 0; /* Stay at the top */
            right: 0;
            background-color: #101011; /* Black */
            overflow-x: hidden; /* Disable horizontal scroll */
            padding: 45px;
        }
        
        #camera-mode {
            position: absolute;
            top: 10px;
            right: 310px;
            padding: 0;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
        }

        #fullscreen {
            position: absolute;
            bottom: 10px;
            right: 460px;
            padding: 0;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
        }

        canvas.emscripten {
            border: 0px none;
            background-color: rgb(31, 33, 51);
        }

        .dropbtn {
            background-color: white;
            color: #101011;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin: auto;

            min-width: 160px;
            width: 100%;
        }

        .dropdown {
            min-width: 160px;
            margin-left: auto;
            width: 100%;
        }

        .dropdown-content {
            display: none;
            background-color: white;
            z-index: 1;

            width: 100%;
            min-width: 160px;
        }

        .dropdown-content a {
            color: black;
            padding: 16px 16px;
            text-decoration: none;
            font-size: 16px;
            display: block;
        }

        .hide {
            display: none;
        }

        .dropdown-content a:hover {
            background-color: rgb(31, 33, 51);
            color: white;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: rgb(31, 33, 51);
            color: white;
        }

        input[type=checkbox] {
            height: 0;
            width: 0;
            visibility: hidden;
        }

        label {
            cursor: pointer;
            text-indent: -9999px;
            width: 64px;
            height: 32px;
            background: grey;
            display: block;
            border-radius: 32px;
            position: relative;
        }

        label:after {
            content: "";
            position: absolute;
            top: 0px;
            left: 0px;
            width: 32px;
            height: 32px;
            background: #fff;
            border-radius: 32px;
            transition: 0.3s;
        }

        input:checked + label {
            background: #bada55;
        }

        input:checked + label:after {
            left: calc(100%);
            transform: translateX(-100%);
        }

        label:active:after {
            width: 45px;
        }
    </style>
    <script>
        let small_screen = false;
        function adjustSmallScreen(e) {
            if(!small_screen && window.innerWidth < 1000) {
                Module.setFullscreen();
                document.getElementById("ui").classList.add("hide");
                document.getElementById("camera-mode").classList.add("hide");
                document.getElementById("header").style.width = String(window.innerWidth)+"px";
                small_screen = true;
            }
            
            if(small_screen && window.innerWidth >= 1000) {
                Module.unsetFullscreen();
                document.getElementById("ui").classList.remove("hide");
                document.getElementById("camera-mode").classList.remove("hide");
                small_screen = false
            }
        }

        var _lastTime;

        function getGLCanvas() {
            return document.getElementById("canvas");
        }

        let is_ortho = false;
        function toggleOrthographic() {
            if (is_ortho) {
                Module.setPerspectiveCamera();
            } else {
                Module.setOrthographicCamera();
            }
            document.getElementById("camera-mode-orthographic").classList.toggle("hide");
            document.getElementById("camera-mode-perspective").classList.toggle("hide");
            is_ortho = !is_ortho;
        }

        let ui_mode, pdb_draw_settings;

        // Main entry point.
        function main() {
            document.getElementById('loading-throbber').remove();

            ui_mode = Module.getUiMode();
            pdb_draw_settings = Module.getPdbDrawSettings();

            if(pdb_draw_settings.draw_hetero_atoms) document.getElementById('switch-hetero').checked = "true";
            if(pdb_draw_settings.draw_water_atoms) document.getElementById('switch-water').checked = "true";
            if(pdb_draw_settings.draw_residue_atoms) document.getElementById('switch-residue').checked = "true";
            if(pdb_draw_settings.draw_residue_ribbons) document.getElementById('switch-ribbon').checked = "true";

            window.addEventListener("resize", adjustSmallScreen);
            adjustSmallScreen();
        }
        
        function fileDropdownClick(is_pdb, path) {
            if(is_pdb)
                Module.loadPdbFile(path); 
            else
                Module.loadMolFile(path); 
            document.getElementById('header').textContent = path;
        }

        function openFullscreen() {
            let elem = document.getElementById("canvas");
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
        }

        function updateDrawSettings() {
            Module.setPdbDrawSettings(pdb_draw_settings);
        }

        // Load the wasm file with Fetch APIs.
        function onBodyLoad() {
            fetch('wasm_app_emsdk.wasm').then(response =>
                response.arrayBuffer()
            ).then(bytes => {
                // Once the wasm file has been loaded, the onRuntimeInitialized callback
                // will be invoked.
                Module.wasmBinary = bytes;
                Module.canvas = (function () {
                    return getGLCanvas();
                })();

                Module.onRuntimeInitialized = function () {
                    main();
                };

                var script = document.createElement('script');
                script.src = "wasm_app_emsdk.js";
                document.body.appendChild(script);

                document.addEventListener('contextmenu', event => event.preventDefault());
            });
        };


    </script>
</head>

<body style="background:black; " onload="onBodyLoad()">
    <canvas class="emscripten" id="canvas">
        This web browser doesn't support canvas tag.
    </canvas>
    <div id="camera-mode" onclick="toggleOrthographic();">
        <div title="Orthographic camera" id="camera-mode-orthographic" >
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path fill="currentColor" d="m22.4 39.65-11-6.45q-.7-.4-1.075-1.1-.375-.7-.375-1.5V17.75q0-.8.375-1.5t1.075-1.1L22.45 8.6q.7-.4 1.55-.4.85 0 1.55.4l11.05 6.55q.7.4 1.075 1.1.375.7.375 1.5V30.6q0 .8-.4 1.5t-1.1 1.1L25.4 39.65q-.7.4-1.5.4t-1.5-.4Zm.1-3.45V25L13 19.55V30.5Zm3 0 9.55-5.7V19.55L25.5 25ZM2 11.45V7.6q0-2.35 1.625-3.975T7.6 2h3.85v3H7.6q-1.1 0-1.85.75T5 7.6v3.85ZM7.6 46q-2.35 0-3.975-1.625T2 40.4v-3.85h3v3.85q0 1.1.75 1.85T7.6 43h3.85v3Zm28.95-.2v-3h3.85q1.1 0 1.85-.75T43 40.2v-3.85h3v3.85q0 2.35-1.625 3.975T40.4 45.8ZM43 11.45V7.6q0-1.1-.75-1.85T40.4 5h-3.85V2h3.85q2.35 0 3.975 1.625T46 7.6v3.85ZM24 22.3l9.5-5.5-9.5-5.45-9.5 5.45Zm0 1.25Zm0-1.25Zm1.5 2.7Zm-3 0Z"/></svg>
        </div>
        <div title="Perspective camera"  id="camera-mode-perspective" class="hide">
            <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path fill="currentColor" d="M7 40q-1.2 0-2.1-.9Q4 38.2 4 37V11q0-1.2.9-2.1Q5.8 8 7 8h26q1.2 0 2.1.9.9.9.9 2.1v10.75l8-8v20.5l-8-8V37q0 1.2-.9 2.1-.9.9-2.1.9Zm0-3h26V11H7v26Zm0 0V11v26Z"/></svg>
        </div>
    </div>
    <!-- <div id="fullscreen" onclick="openFullscreen();">
        <svg xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path fill="currentColor"  d="M10 38v-9.65h3V35h6.65v3Zm0-18.35V10h9.65v3H13v6.65ZM28.35 38v-3H35v-6.65h3V38ZM35 19.65V13h-6.65v-3H38v9.65Z"/></svg>
    </div> -->

    <div class="throbber" id="loading-throbber"></div>
    <div class="header" id="header">data/examples/pdb/1bzv.pdb</div>

    <div class="ui" id="ui">
        <div class="dropdown">
            <button class="dropbtn">Load Protein/Molecule</button>
            <div id="file-select-dropdown-content" class="dropdown-content">
                <a href="#" onclick="fileDropdownClick(true, 'data/examples/pdb/1bzv.pdb');">1bzv.pdb</a>
                <a href="#" onclick="fileDropdownClick(true, 'data/examples/pdb/4hhb.pdb');">4hhb.pdb</a>
                <a href="#" onclick="fileDropdownClick(true, 'data/examples/pdb/6w63.pdb');">6w63.pdb</a>
                <a href="#" onclick="fileDropdownClick(true, 'data/examples/pdb/7vhd.pdb');">7vhd.pdb</a>
                <a href="#" onclick="fileDropdownClick(false, 'data/examples/molfiles/fullerene.mol');">fullerene.mol</a>
                <a href="#" onclick="fileDropdownClick(false, 'data/examples/molfiles/ethanol.mol');">ethanol.mol</a>
                <a href="#" onclick="fileDropdownClick(false, 'data/examples/molfiles/caffeine.mol');">caffeine.mol</a>
            </div>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 16px;">
            <div style="line-height: 16px; height: 16px; text-align: center;">
                <p style="color: white; font-size: 16px;">Heterogen atoms</p>
            </div>
            <div style="bottom: 0px;">
                <input type="checkbox" id="switch-hetero" onclick="pdb_draw_settings.draw_hetero_atoms = !pdb_draw_settings.draw_hetero_atoms; updateDrawSettings();"/><label for="switch-hetero">Toggle</label>
            </div>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 16px;">
            <div style="line-height: 16px; height: 16px; text-align: center;">
                <p style="color: white; font-size: 16px;">Water atoms</p>
            </div>
            <div style="bottom: 0px;">
                <input type="checkbox" id="switch-water" onclick="pdb_draw_settings.draw_water_atoms = !pdb_draw_settings.draw_water_atoms; updateDrawSettings();"/><label for="switch-water">Toggle</label>
            </div>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 16px;">
            <div style="line-height: 16px; height: 16px; text-align: center;">
                <p style="color: white; font-size: 16px;">Residue atoms</p>
            </div>
            <div style="bottom: 0px;">
                <input type="checkbox" id="switch-residue" onclick="pdb_draw_settings.draw_residue_atoms = !pdb_draw_settings.draw_residue_atoms; updateDrawSettings();"/><label for="switch-residue">Toggle</label>
            </div>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 16px;">
            <div style="line-height: 16px; height: 16px; text-align: center;">
                <p style="color: white; font-size: 16px;">Residue ribbon</p>
            </div>
            <div style="bottom: 0px;">
                <input type="checkbox" id="switch-ribbon" onclick="pdb_draw_settings.draw_residue_ribbons = !pdb_draw_settings.draw_residue_ribbons; updateDrawSettings();"/><label for="switch-ribbon">Toggle</label>
            </div>
        </div>

        <div class="dropdown" title="Residue coloring" style="padding-top: 32px;">
            <!-- @todo not @hardcoded  -->
            <button class="dropbtn" id="dropdown-residue-coloring">Chain</button> 
            <div id="file-select-dropdown-content" class="dropdown-content">
                <a href="#" onclick="pdb_draw_settings.residue_color_mode = Module.PdbResidueColorMode.CHAIN; updateDrawSettings(); document.getElementById('dropdown-residue-coloring').textContent = 'Chain';">Chain</a>
                <a href="#" onclick="pdb_draw_settings.residue_color_mode = Module.PdbResidueColorMode.SECONDARY; updateDrawSettings();  document.getElementById('dropdown-residue-coloring').textContent = 'Secondary';">Secondary</a>
                <a href="#" onclick="pdb_draw_settings.residue_color_mode = Module.PdbResidueColorMode.AMINO_ACID; updateDrawSettings();  document.getElementById('dropdown-residue-coloring').textContent = 'Amino Acid';">Amino Acid</a>
            </div>
        </div>
    </div>

    <script>
        var Module =
        {
            canvas: (function () {
                var canvas = document.getElementById('canvas');

                // As a default initial behavior, pop up an alert when webgl context is lost. To make your
                // application robust, you may want to override this behavior before shipping!
                // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
                canvas.addEventListener("webglcontextlost", function (e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);

                return canvas;
            })(),

            preRun: [],
            postRun: [],
            printErr: function () {
                console.warn(Array.prototype.slice.call(arguments).join(" "));
            },
            print: function () {
                console.warn(Array.prototype.slice.call(arguments).join(" "));
            }
        };
    </script>
</body>

</html>